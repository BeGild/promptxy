# 路由配置界面重新设计

## 背景

当前路由配置页面显示简陋，当存在入站 `/claude` 出站选择不同供应商时，无法直观从页面看出流量流向和协议转换关系。

## 目标

通过卡片式流量可视化设计，让用户一眼看清：
- 入站端点（路径 + 协议）
- 出站供应商（品牌 + 模型）
- 协议转换关系（如 Claude → OpenAI）

## 设计方案

### 整体布局

路由卡片采用横向三栏布局，从左到右展示完整的流量路径：

```
┌─────────────────────────────────────────────────────────────┐
│  [Claude图标]  /claude        →        [OpenAI图标]  gpt-4  │
│  Anthropic协议                         OpenAI Chat          │
└─────────────────────────────────────────────────────────────┘
```

### 视觉设计

**颜色编码（复用现有供应商页面颜色）**：
- 入站端点：使用品牌色背景（Claude 橙色 #D4935D，Codex 深色 #2D3748，Gemini 蓝色 #4285F4）
- 流向箭头：协议转换时使用渐变色（入站品牌色 → 出站品牌色）
- 出站供应商：使用品牌色作为边框/标签色

**图标系统（复用现有图标）**：
- 供应商显示 `SupplierIcons` 中的专属图标
- 协议转换时显示双向箭头标识

**状态标识**：
- 禁用状态：整体透明度 50%，添加"已禁用"标签
- 模型透传：显示"透传"标签

### Claude 路由的模型映射显示

多条规则采用垂直列表堆叠，每条规则显示：

```
┌─────────────────────────────────────────────────────────────┐
│  [Claude图标]  /claude                                      │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  *-sonnet-*     →     [OpenAI]   gpt-4o            │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  *-haiku-*      →     [Gemini]   gemini-pro        │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  claude-3-opus  →     [Anthropic] 透传             │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 交互设计

**悬停效果**：
- 悬停卡片时高亮显示流量路径
- 显示编辑/删除按钮

**点击展开**：
- 点击卡片展开详细视图
- 显示完整的模型映射表格（入站模式、优先级、目标供应商、出站模型）

**快速操作**：
- 开关切换路由启用状态
- 拖拽调整模型映射规则优先级（Claude 路由）

### 组件结构

```
RouteConfigPage.tsx
├── RouteFlowCard (新组件)      # 单条路由的流量卡片
│   ├── InboundEndpoint         # 入站端点显示
│   ├── FlowArrow               # 流向箭头（含协议转换标识）
│   └── OutboundConfig          # 出站配置（单供应商或规则列表）
│       └── ModelMappingRule    # 单条映射规则行
└── RouteFlowDetail (展开视图)   # 详细映射表格
```

### 数据结构

复用现有类型，无需后端改动：

```typescript
interface Route {
  id: string;
  localService: 'claude' | 'codex' | 'gemini';
  modelMappings?: ModelMappingRule[];  // Claude 路由使用
  singleSupplierId?: string;            // Codex/Gemini 路由使用
  enabled: boolean;
}

interface ModelMappingRule {
  id: string;
  inboundModel: string;        // 入站模型通配符
  targetSupplierId: string;    // 目标供应商ID
  outboundModel?: string;      // 出站模型（空则透传）
  description?: string;
  enabled?: boolean;
}
```

## 实施计划

1. 创建 `RouteFlowCard` 组件
2. 创建 `InboundEndpoint` 子组件
3. 创建 `FlowArrow` 子组件
4. 创建 `OutboundConfig` 子组件
5. 更新 `RouteConfigPage` 使用新组件
6. 添加展开详情功能

## 验收标准

- [ ] 路由卡片清晰展示入站 → 出站流量路径
- [ ] Claude 路由垂直堆叠显示所有模型映射规则
- [ ] Codex/Gemini 路由显示单一供应商流向
- [ ] 协议转换通过颜色/箭头直观体现
- [ ] 禁用状态视觉区分明显
- [ ] 响应式布局适配移动端
