# PromptXY å®Œæ•´æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: v2.1
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-20
> **æ›´æ–°æ—¥æœŸ**: 2025-12-31
> **çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
promptxy/
â”œâ”€â”€ src/                          # npm åŒ…æºä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰
â”‚   â”œâ”€â”€ main.ts                   # åŒ…å…¥å£ï¼Œåˆ›å»ºç»Ÿä¸€æœåŠ¡å™¨
â”‚   â””â”€â”€ promptxy/
â”‚       â”œâ”€â”€ gateway.ts            # ç»Ÿä¸€ç½‘å…³æ ¸å¿ƒ
â”‚       â”œâ”€â”€ config.ts             # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ types.ts              # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ cli.ts                # å‘½ä»¤è¡Œè§£æ
â”‚       â”œâ”€â”€ http.ts               # HTTP å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ logger.ts             # æ—¥å¿—å·¥å…·
â”‚       â”œâ”€â”€ rules/                # è§„åˆ™å¼•æ“
â”‚       â”‚   â””â”€â”€ engine.ts         # è§„åˆ™æ‰§è¡Œå¼•æ“
â”‚       â””â”€â”€ adapters/             # AI æœåŠ¡é€‚é…å™¨
â”‚           â”œâ”€â”€ claude.ts         # Claude é€‚é…å™¨
â”‚           â”œâ”€â”€ codex.ts          # Codex é€‚é…å™¨
â”‚           â””â”€â”€ gemini.ts         # Gemini é€‚é…å™¨
â”‚
â”œâ”€â”€ backend/                      # å®Œæ•´ç‰ˆï¼ˆå¸¦ Web UIï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.ts               # å®Œæ•´æœåŠ¡çš„å…¥å£
â”‚       â””â”€â”€ promptxy/
â”‚           â”œâ”€â”€ gateway.ts        # ç»Ÿä¸€ç½‘å…³æ ¸å¿ƒ
â”‚           â”œâ”€â”€ config.ts         # é…ç½®ç®¡ç†
â”‚           â”œâ”€â”€ database.ts       # SQLite æ•°æ®åº“
â”‚           â”œâ”€â”€ types.ts          # ç±»å‹å®šä¹‰
â”‚           â”œâ”€â”€ api-handlers.ts   # API å¤„ç†å™¨
â”‚           â”œâ”€â”€ cli.ts            # å‘½ä»¤è¡Œè§£æ
â”‚           â”œâ”€â”€ http.ts           # HTTP å·¥å…·å‡½æ•°
â”‚           â”œâ”€â”€ logger.ts         # æ—¥å¿—å·¥å…·
â”‚           â”œâ”€â”€ port-utils.ts     # ç«¯å£å·¥å…·
â”‚           â”œâ”€â”€ rules/            # è§„åˆ™å¼•æ“
â”‚           â”‚   â””â”€â”€ engine.ts     # è§„åˆ™æ‰§è¡Œå¼•æ“
â”‚           â””â”€â”€ adapters/         # AI æœåŠ¡é€‚é…å™¨
â”‚               â”œâ”€â”€ claude.ts     # Claude é€‚é…å™¨
â”‚               â”œâ”€â”€ codex.ts      # Codex é€‚é…å™¨
â”‚               â””â”€â”€ gemini.ts     # Gemini é€‚é…å™¨
â”‚
â”œâ”€â”€ frontend/                     # å‰ç«¯åº”ç”¨ (React + HeroUI)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx              # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.tsx               # ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/           # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ rules/            # è§„åˆ™ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ requests/         # è¯·æ±‚ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ preview/          # é¢„è§ˆç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ common/           # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/                # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ hooks/                # React Hooks
â”‚   â”‚   â”œâ”€â”€ api/                  # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ store/                # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/                # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ styles/               # æ ·å¼
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ scripts/                      # æ„å»ºå’Œå¼€å‘è„šæœ¬
â”‚   â”œâ”€â”€ dev.sh                    # å¼€å‘ç¯å¢ƒå¯åŠ¨
â”‚   â”œâ”€â”€ build.sh                  # æ„å»º
â”‚   â””â”€â”€ start.sh                  # å¯åŠ¨
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md           # æ­¤æ–‡ä»¶
â”‚   â”œâ”€â”€ configuration.md          # é…ç½®å‚è€ƒ
â”‚   â”œâ”€â”€ origin_and_requirements.md # é¡¹ç›®èƒŒæ™¯
â”‚   â””â”€â”€ usage.md                  # ä½¿ç”¨æŒ‡å—
â”‚
â”œâ”€â”€ openspec/                     # OpenSpec è§„èŒƒ
â”‚   â”œâ”€â”€ specs/                    # å·²å®ç°åŠŸèƒ½è§„èŒƒ
â”‚   â””â”€â”€ changes/                  # å˜æ›´ææ¡ˆ
â”‚
â”œâ”€â”€ package.json                  # ä¸»åŒ…é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â””â”€â”€ README.md
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. ç»Ÿä¸€æ¶æ„

- **å¼€å‘æ—¶**ï¼šå‰åç«¯ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹å¯åŠ¨ï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- **ç”Ÿäº§æ—¶**ï¼šç»Ÿä¸€ç«¯å£éƒ¨ç½²ï¼ˆé»˜è®¤ 7070ï¼‰
- **é€šä¿¡**ï¼šHTTP API + SSE å®æ—¶æ¨é€

### 2. æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æ“ä½œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (React + HeroUI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  è§„åˆ™ç®¡ç†    â”‚  â”‚  è¯·æ±‚æŸ¥çœ‹    â”‚  â”‚  é¢„è§ˆæµ‹è¯•    â”‚     â”‚
â”‚  â”‚  (UIå±‚)      â”‚  â”‚  (UIå±‚)      â”‚  â”‚  (UIå±‚)      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                 â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                  â”‚                 â”‚                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚  APIå®¢æˆ·ç«¯      â”‚  â”‚  SSEå®¢æˆ·ç«¯ â”‚               â”‚
â”‚         â”‚  (fetch/axios)  â”‚  â”‚  (EventSource)â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚
                   â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PromptXY ç»Ÿä¸€æœåŠ¡å™¨ (ç«¯å£ 7070)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  APIè·¯ç”±     â”‚  â”‚  SSEæ¨é€     â”‚  â”‚  ä»£ç†æ ¸å¿ƒ    â”‚  â”‚
â”‚  â”‚  â”‚  /_promptxy/*â”‚  â”‚  /_promptxy  â”‚  â”‚  /claude/*   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  /codex/*    â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  /gemini/*   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚            â”‚                  â”‚                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                     â”‚                  â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚            â”‚  SQLiteæ•°æ®åº“   â”‚  â”‚  é…ç½®æ–‡ä»¶  â”‚               â”‚
â”‚            â”‚  (è¯·æ±‚å†å²)     â”‚  â”‚  (è§„åˆ™)    â”‚               â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIå·¥å…· (Claude/Codex/Gemini)             â”‚
â”‚  å‘èµ·è¯·æ±‚ â†’ ç»è¿‡ä»£ç† â†’ è§„åˆ™ä¿®æ”¹ â†’ è½¬å‘ä¸Šæ¸¸API                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API é€šä¿¡åè®®

### ç»Ÿä¸€æœåŠ¡å™¨ç«¯ç‚¹ï¼ˆç«¯å£ 7070ï¼‰

æ‰€æœ‰ API éƒ½åœ¨åŒä¸€ç«¯å£ä¸Šï¼Œä½¿ç”¨ `/_promptxy/` å‰ç¼€ï¼š

#### 1. å¥åº·æ£€æŸ¥

```
GET /_promptxy/health
```

#### 2. é…ç½®ç®¡ç†

```
GET    /_promptxy/config             # è·å–é…ç½®
POST   /_promptxy/config/sync        # åŒæ­¥é…ç½®ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
```

#### 3. è§„åˆ™æµ‹è¯•

```
POST /_promptxy/preview              # é¢„è§ˆè§„åˆ™æ•ˆæœ
```

#### 4. è¯·æ±‚å†å²

```
GET    /_promptxy/requests           # è·å–è¯·æ±‚åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
GET    /_promptxy/requests/:id       # è·å–è¯·æ±‚è¯¦æƒ…
POST   /_promptxy/requests/cleanup   # æ¸…ç†æ—§æ•°æ®
DELETE /_promptxy/requests/:id       # åˆ é™¤å•ä¸ªè¯·æ±‚
```

#### 5. å®æ—¶æ¨é€

```
GET /_promptxy/events                # SSE è¿æ¥ï¼ˆæ–°è¯·æ±‚æ¨é€ï¼‰
```

#### 6. ä¾›åº”å•†ç®¡ç†

```
GET    /_promptxy/suppliers          # è·å–ä¾›åº”å•†åˆ—è¡¨
POST   /_promptxy/suppliers          # åˆ›å»ºä¾›åº”å•†
PUT    /_promptxy/suppliers/:id      # æ›´æ–°ä¾›åº”å•†
DELETE /_promptxy/suppliers/:id      # åˆ é™¤ä¾›åº”å•†
POST   /_promptxy/suppliers/:id/toggle  # åˆ‡æ¢ä¾›åº”å•†çŠ¶æ€
```

#### 7. å…¶ä»–

```
GET    /_promptxy/paths              # è·å–å”¯ä¸€è·¯å¾„åˆ—è¡¨
GET    /_promptxy/settings           # è·å–è®¾ç½®
POST   /_promptxy/settings           # æ›´æ–°è®¾ç½®
GET    /_promptxy/stats              # ç»Ÿè®¡ä¿¡æ¯
GET    /_promptxy/database           # æ•°æ®åº“ä¿¡æ¯
```

### SSEäº‹ä»¶ç±»å‹

```typescript
// æ–°è¯·æ±‚äº‹ä»¶
event: request
data: {
  "id": "req-20251220-143215-abc",
  "timestamp": 1734705135000,
  "client": "codex",
  "path": "/v1/chat/completions",
  "method": "POST"
}

// é…ç½®æ›´æ–°äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
event: config_updated
data: {
  "timestamp": 1734705135000,
  "ruleCount": 42
}
```

---
## ğŸ“Š æ•°æ®æ¨¡å‹

### 1. è§„åˆ™ (Rule)

```typescript
interface Rule {
  uuid: string; // è§„åˆ™å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
  name: string; // è§„åˆ™åç§°
  description?: string; // æè¿°

  when: {
    client: 'claude' | 'codex' | 'gemini';
    field: 'system' | 'instructions';
    method?: string;
    pathRegex?: string;
    modelRegex?: string;
  };

  ops: Array<
    | { type: 'set'; text: string }
    | { type: 'append'; text: string }
    | { type: 'prepend'; text: string }
    | { type: 'replace'; match?: string; regex?: string; flags?: string; replacement: string }
    | { type: 'delete'; match?: string; regex?: string; flags?: string }
    | { type: 'insert_before'; regex: string; flags?: string; text: string }
    | { type: 'insert_after'; regex: string; flags?: string; text: string }
  >;

  stop?: boolean; // æ˜¯å¦åœ¨æ­¤ååœæ­¢
  enabled?: boolean; // æ˜¯å¦å¯ç”¨
  createdAt?: number; // åˆ›å»ºæ—¶é—´
  updatedAt?: number; // æ›´æ–°æ—¶é—´
}
```

### 2. è¯·æ±‚è®°å½• (RequestRecord)

```typescript
interface RequestRecord {
  id: string;
  timestamp: number;

  // è¯·æ±‚ä¿¡æ¯
  client: string;
  path: string;
  method: string;

  // è¯·æ±‚ä½“
  originalBody: any; // åŸå§‹è¯·æ±‚
  modifiedBody: any; // ä¿®æ”¹åè¯·æ±‚

  // è§„åˆ™åŒ¹é…
  matchedRules: Array<{
    ruleId: string;
    opType: string;
  }>;

  // å“åº”ä¿¡æ¯
  responseStatus?: number;
  durationMs?: number;
  responseHeaders?: Record<string, string>;
  error?: string;
}
```

### 3. é…ç½® (Config)

**ç®€åŒ–ç‰ˆé…ç½®**ï¼š

```typescript
interface Config {
  listen: {
    host: string;
    port: number; // ä»£ç†ç«¯å£ 7070
  };

  upstreams: {
    anthropic: string;
    openai: string;
    gemini: string;
  };

  rules: Rule[];
  debug: boolean;
}
```

**å®Œæ•´ç‰ˆé…ç½®**ï¼š

```typescript
interface Config {
  listen: {
    host: string;
    port: number; // ä»£ç†ç«¯å£ 7070
  };

  suppliers: Supplier[];

  rules: Rule[];

  storage: {
    maxHistory: number; // 1000
  };

  debug: boolean;
}

interface Supplier {
  id: string;
  name: string;
  baseUrl: string;
  localPrefix: string; // å¦‚ /claude
  pathMappings?: PathMapping[];
  enabled: boolean;
}
```

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### æµç¨‹1ï¼šè§„åˆ™ç¼–è¾‘ä¸ç”Ÿæ•ˆ

```
ç”¨æˆ·åœ¨å‰ç«¯ç¼–è¾‘è§„åˆ™
  â†“
ç‚¹å‡»ä¿å­˜
  â†“
å‰ç«¯ POST /api/config/sync
  â†“
åç«¯ï¼š
  1. éªŒè¯è§„åˆ™æ ¼å¼
  2. æ›´æ–°å†…å­˜ä¸­çš„config.rules
  3. å†™å…¥ ~/.local/promptxy/config.json
  4. è¿”å›æˆåŠŸ
  â†“
å‰ç«¯æ˜¾ç¤ºä¿å­˜æˆåŠŸ
  â†“
ä¸‹ä¸€ä¸ªCLIè¯·æ±‚åˆ°è¾¾ä»£ç†(7070)
  â†“
ä»£ç†ä½¿ç”¨æ–°è§„åˆ™ä¿®æ”¹è¯·æ±‚
  â†“
å®Œæˆ
```

### æµç¨‹2ï¼šè¯·æ±‚æ•è·ä¸å±•ç¤º

```
CLIå‘èµ·è¯·æ±‚ â†’ ä»£ç†(7070)
  â†“
ä»£ç†æ•è·è¯·æ±‚ï¼š
  1. è®°å½•åŸå§‹è¯·æ±‚ä½“
  2. åº”ç”¨è§„åˆ™ â†’ å¾—åˆ°ä¿®æ”¹åè¯·æ±‚
  3. è½¬å‘åˆ°ä¸Šæ¸¸API
  4. è·å–å“åº”
  5. è®°å½•åˆ°SQLite
  6. é€šè¿‡SSEæ¨é€äº‹ä»¶
  â†“
å‰ç«¯SSEå®¢æˆ·ç«¯æ”¶åˆ°äº‹ä»¶
  â†“
å‰ç«¯ GET /api/requests/:id
  â†“
æ˜¾ç¤ºè¯·æ±‚è¯¦æƒ…ï¼ˆåŸå§‹ vs ä¿®æ”¹å¯¹æ¯”ï¼‰
```

### æµç¨‹3ï¼šæ•°æ®æ¸…ç†

```
åç«¯å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶ï¼‰ï¼š
  â†“
æ£€æŸ¥æ•°æ®åº“è®°å½•æ•°
  â†“
å¦‚æœ > 100æ¡
  â†“
DELETE FROM requests
WHERE id NOT IN (
  SELECT id FROM requests
  ORDER BY timestamp DESC
  LIMIT 100
)
  â†“
è®°å½•æ¸…ç†æ—¥å¿—
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡ï¼ˆHeroUIï¼‰

### é¡µé¢1ï¼šè§„åˆ™åˆ—è¡¨ (RulesPage)

**ç»„ä»¶ç»“æ„ï¼š**

```
<Page>
  <Header title="è§„åˆ™ç®¡ç†" actions={[æ–°å»º, æ‰¹é‡æ“ä½œ]} />

  <SearchAndFilter>
    <Input placeholder="æœç´¢è§„åˆ™..." />
    <Select label="å®¢æˆ·ç«¯" options={[å…¨éƒ¨, Claude, Codex, Gemini]} />
    <Select label="çŠ¶æ€" options={[å…¨éƒ¨, å¯ç”¨, ç¦ç”¨]} />
  </SearchAndFilter>

  <Stats cards={[
    { label: 'æ€»æ•°', value: 42 },
    { label: 'å¯ç”¨', value: 38, color: 'success' },
    { label: 'ç¦ç”¨', value: 4, color: 'error' }
  ]} />

  <RuleList>
    {rules.map(rule => (
      <RuleCard
        key={rule.id}
        rule={rule}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onToggle={handleToggle}
      />
    ))}
  </RuleList>

  <Pagination />
</Page>
```

**HeroUIç»„ä»¶ä½¿ç”¨ï¼š**

- `@heroui/input` - æœç´¢æ¡†
- `@heroui/select` - ç­›é€‰å™¨
- `@heroui/card` - è§„åˆ™å¡ç‰‡
- `@heroui/button` - æ“ä½œæŒ‰é’®
- `@heroui/modal` - ç¼–è¾‘å¼¹çª—
- `@heroui/pagination` - åˆ†é¡µ

### é¡µé¢2ï¼šè¯·æ±‚è¯¦æƒ… (RequestDetail)

**ç»„ä»¶ç»“æ„ï¼š**

```
<Modal open={true} onClose={close}>
  <Modal.Header>
    <Text h3>è¯·æ±‚è¯¦æƒ…</Text>
  </Modal.Header>

  <Modal.Body>
    <Grid>
      <Grid xs={12}>
        <Card>
          <Card.Body>
            <Description
              data={{
                ID: request.id,
                æ—¶é—´: formatTime(request.timestamp),
                å®¢æˆ·ç«¯: request.client,
                è·¯å¾„: request.path,
                çŠ¶æ€: request.responseStatus
              }}
            />
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={6}>
        <Card>
          <Card.Header>åŸå§‹è¯·æ±‚</Card.Header>
          <Card.Body>
            <CodeBlock language="json">
              {JSON.stringify(request.originalBody, null, 2)}
            </CodeBlock>
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={6}>
        <Card>
          <Card.Header>ä¿®æ”¹åè¯·æ±‚</Card.Header>
          <Card.Body>
            <CodeBlock language="json">
              {JSON.stringify(request.modifiedBody, null, 2)}
            </CodeBlock>
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={12}>
        <Card>
          <Card.Header>åŒ¹é…è§„åˆ™</Card.Header>
          <Card.Body>
            <List>
              {request.matchedRules.map(match => (
                <List.Item key={match.ruleId}>
                  {match.ruleId} ({match.opType})
                </List.Item>
              ))}
            </List>
          </Card.Body>
        </Card>
      </Grid>
    </Grid>
  </Modal.Body>

  <Modal.Footer>
    <Button onPress={replay}>é‡æ”¾</Button>
    <Button onPress={export}>å¯¼å‡º</Button>
    <Button onPress={close}>å…³é—­</Button>
  </Modal.Footer>
</Modal>
```

---

## ğŸ“ å®ç°çŠ¶æ€

### å·²å®ŒæˆåŠŸèƒ½

- âœ… ç®€åŒ–ç‰ˆï¼ˆnpm åŒ…ï¼‰æ ¸å¿ƒåŠŸèƒ½
  - âœ… ç»Ÿä¸€ç½‘å…³æ ¸å¿ƒ
  - âœ… é…ç½®ç®¡ç†
  - âœ… è§„åˆ™å¼•æ“ï¼ˆ7ç§æ“ä½œç±»å‹ï¼‰
  - âœ… AI æœåŠ¡é€‚é…å™¨ï¼ˆClaudeã€Codexã€Geminiï¼‰

- âœ… å®Œæ•´ç‰ˆï¼ˆå¸¦ Web UIï¼‰
  - âœ… SQLite æ•°æ®åº“
  - âœ… API å¤„ç†å™¨
  - âœ… SSE å®æ—¶æ¨é€
  - âœ… ä¾›åº”å•†ç®¡ç†
  - âœ… è¯·æ±‚å†å²è®°å½•

- âœ… å‰ç«¯åº”ç”¨ï¼ˆReact + HeroUIï¼‰
  - âœ… è§„åˆ™ç®¡ç†é¡µé¢
  - âœ… è¯·æ±‚ç›‘æ§é¡µé¢
  - âœ… é¢„è§ˆæµ‹è¯•é¡µé¢
  - âœ… è®¾ç½®ç®¡ç†é¡µé¢
  - âœ… é›†æˆæµ‹è¯•å¥—ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ

**1. å¯åŠ¨åç«¯**

```bash
cd backend
npm install
npm run dev  # ç›‘å¬æ¨¡å¼ï¼Œç«¯å£è‡ªåŠ¨åˆ†é…ï¼ˆ8000-9000èŒƒå›´ï¼‰
```

**2. å¯åŠ¨å‰ç«¯**

```bash
cd frontend
npm install
npm run dev  # Vite å¼€å‘æœåŠ¡å™¨ï¼Œé»˜è®¤ 5173
```

**3. é…ç½®ä»£ç†**

```bash
# Claude Code
export ANTHROPIC_BASE_URL="http://127.0.0.1:PORT/claude"

# Codex CLI
export OPENAI_BASE_URL="http://127.0.0.1:PORT/codex"

# Gemini CLI
export GOOGLE_GEMINI_BASE_URL="http://127.0.0.1:PORT/gemini"
```

**4. è®¿é—® Web UI**

```
http://localhost:5173
```

### ç”Ÿäº§éƒ¨ç½²

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ npm åŒ…ï¼ˆæ¨èï¼‰**

```bash
npm install -g promptxy
promptxy --port 7070
```

**æ–¹å¼äºŒï¼šä»æºç æ„å»º**

```bash
npm run build
npm start -- --port 7070
```

è®¿é—® Web UI: `http://127.0.0.1:7070/_promptxy/`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1
**åˆ›å»ºæ—¥æœŸ**: 2025-12-20
**æ›´æ–°æ—¥æœŸ**: 2025-12-30
**çŠ¶æ€**: âœ… å·²å®ç°

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆåˆ†å¼€å¼€å‘ä½†ç»Ÿä¸€éƒ¨ç½²ï¼Ÿ

- **å¼€å‘ä½“éªŒ**ï¼šå‰ç«¯çƒ­é‡è½½ï¼Œåç«¯ç‹¬ç«‹é‡å¯
- **éƒ¨ç½²ç®€å•**ï¼šæœ€ç»ˆä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªç«¯å£
- **ç»´æŠ¤æ–¹ä¾¿**ï¼šæ¸…æ™°çš„ä»£ç åˆ†ç¦»

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨SSEè€Œä¸æ˜¯WebSocketï¼Ÿ

- **å•å‘é€šä¿¡**ï¼šåªéœ€è¦æœåŠ¡å™¨æ¨é€æ–°è¯·æ±‚
- **å®ç°ç®€å•**ï¼šåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–åº“
- **èµ„æºå‹å¥½**ï¼šè¿æ¥æ•°é™åˆ¶æ›´å°‘

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨SQLiteè€Œä¸æ˜¯æ–‡ä»¶JSONï¼Ÿ

- **æŸ¥è¯¢èƒ½åŠ›**ï¼šæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€ç´¢å¼•
- **å¹¶å‘å®‰å…¨**ï¼šé¿å…æ–‡ä»¶é”é—®é¢˜
- **æ€§èƒ½**ï¼š100æ¡è®°å½•æŸ¥è¯¢æ¯«ç§’çº§

### 4. ä¸ºä»€ä¹ˆä½¿ç”¨HeroUIï¼Ÿ

- **ç»„ä»¶ä¸°å¯Œ**ï¼šè¡¨å•ã€è¡¨æ ¼ã€æ¨¡æ€æ¡†ç­‰å¼€ç®±å³ç”¨
- **ç¾è§‚ä¸“ä¸š**ï¼šç¬¦åˆå¼€å‘è€…å·¥å…·å®¡ç¾
- **TypeScriptå‹å¥½**ï¼šå®Œæ•´ç±»å‹æ”¯æŒ
- **Tailwindé›†æˆ**ï¼šæ˜“äºè‡ªå®šä¹‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é…ç½®å‚è€ƒ](./configuration.md) - é…ç½®æ–‡ä»¶è¯¦è§£
- [ä½¿ç”¨æŒ‡å—](./usage.md) - CLI é…ç½®å’Œè§„åˆ™è¯­æ³•
- [é¡¹ç›®èƒŒæ™¯](./origin_and_requirements.md) - é¡¹ç›®åˆè¡·ä¸éœ€æ±‚æº¯æº

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1
**åˆ›å»ºæ—¥æœŸ**: 2025-12-20
**æ›´æ–°æ—¥æœŸ**: 2025-12-31
**çŠ¶æ€**: âœ… å·²å®ç°
