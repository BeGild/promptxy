# PromptXY å®Œæ•´æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: v2.0 (å‰åç«¯åˆ†ç¦»ç‰ˆ)
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-20
> **çŠ¶æ€**: å¾…å®ç°

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
promptxy/
â”œâ”€â”€ backend/                      # åç«¯æœåŠ¡ (Node.js + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts              # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ gateway.ts           # HTTPä»£ç†æ ¸å¿ƒ (ç«¯å£: 7070)
â”‚   â”‚   â”œâ”€â”€ api-server.ts        # APIæœåŠ¡å™¨ (ç«¯å£: 7071)
â”‚   â”‚   â”œâ”€â”€ database.ts          # SQLiteæ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ config.ts            # é…ç½®æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types.ts             # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ rules/
â”‚   â”‚       â””â”€â”€ engine.ts        # è§„åˆ™å¼•æ“ (å·²æœ‰)
â”‚   â”‚   â””â”€â”€ adapters/
â”‚   â”‚       â”œâ”€â”€ claude.ts        # Claudeé€‚é…å™¨ (å·²æœ‰)
â”‚   â”‚       â”œâ”€â”€ codex.ts         # Codexé€‚é…å™¨ (å·²æœ‰)
â”‚   â”‚       â””â”€â”€ gemini.ts        # Geminié€‚é…å™¨ (å·²æœ‰)
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ frontend/                     # å‰ç«¯åº”ç”¨ (React + HeroUI)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx             # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.tsx              # ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DetailPanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ rules/           # è§„åˆ™ç›¸å…³
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RuleList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RuleEditor.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RuleCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ requests/        # è¯·æ±‚ç›¸å…³
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RequestList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RequestDetail.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DiffViewer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ preview/         # é¢„è§ˆç›¸å…³
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PreviewPanel.tsx
â”‚   â”‚   â”‚   â””â”€â”€ common/          # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ StatusIndicator.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚       â””â”€â”€ EmptyState.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ RulesPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RequestsPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PreviewPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SettingsPage.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useRules.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useRequests.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useSSE.ts
â”‚   â”‚   â”‚   â””â”€â”€ useConfig.ts
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts        # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ rules.ts         # è§„åˆ™API
â”‚   â”‚   â”‚   â”œâ”€â”€ requests.ts      # è¯·æ±‚API
â”‚   â”‚   â”‚   â””â”€â”€ sse.ts           # SSEå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # Zustand store
â”‚   â”‚   â”‚   â”œâ”€â”€ app-store.ts     # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ ui-store.ts      # UIçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # å¯¼å‡ºæ‰€æœ‰ç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ rule.ts          # è§„åˆ™ç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ request.ts       # è¯·æ±‚ç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ api.ts           # APIç±»å‹
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ formatter.ts     # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ validator.ts     # éªŒè¯å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ diff.ts          # å·®å¼‚å¯¹æ¯”ç®—æ³•
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â”œâ”€â”€ globals.css      # å…¨å±€æ ·å¼
â”‚   â”‚       â””â”€â”€ components.css   # ç»„ä»¶æ ·å¼
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ tailwind.config.js       # HeroUIéœ€è¦
â”‚   â””â”€â”€ postcss.config.js
â”‚
â”œâ”€â”€ scripts/                      # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ build.sh                 # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ start.sh                 # å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ dev.sh                   # å¼€å‘è„šæœ¬
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md          # æ­¤æ–‡ä»¶
â”‚   â”œâ”€â”€ BACKEND_API_EXTENSION.md # åç«¯API
â”‚   â”œâ”€â”€ FRONTEND_SETUP.md        # å‰ç«¯é…ç½®
â”‚   â””â”€â”€ DEPLOYMENT.md            # éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ package.json                 # æ ¹çº§ï¼Œç”¨äºä¸€é”®å¯åŠ¨
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. å‰åç«¯åˆ†ç¦»ä½†ç»Ÿä¸€éƒ¨ç½²
- **å¼€å‘æ—¶**ï¼šç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹å¯åŠ¨
- **éƒ¨ç½²æ—¶**ï¼šåˆå¹¶ä¸ºä¸€ä¸ªåŒ…ï¼Œç»Ÿä¸€ç®¡ç†
- **é€šä¿¡**ï¼šHTTP API + SSEå®æ—¶æ¨é€

### 2. æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æ“ä½œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (React + HeroUI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  è§„åˆ™ç®¡ç†    â”‚  â”‚  è¯·æ±‚æŸ¥çœ‹    â”‚  â”‚  é¢„è§ˆæµ‹è¯•    â”‚     â”‚
â”‚  â”‚  (UIå±‚)      â”‚  â”‚  (UIå±‚)      â”‚  â”‚  (UIå±‚)      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                 â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                  â”‚                 â”‚                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚  APIå®¢æˆ·ç«¯      â”‚  â”‚  SSEå®¢æˆ·ç«¯ â”‚               â”‚
â”‚         â”‚  (fetch/axios)  â”‚  â”‚  (EventSource)â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚
                   â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯ (Node.js + TS)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  APIæœåŠ¡å™¨   â”‚  â”‚  SSEæ¨é€     â”‚  â”‚  ä»£ç†æ ¸å¿ƒ    â”‚     â”‚
â”‚  â”‚  (ç«¯å£7071)  â”‚  â”‚  (ç«¯å£7071)  â”‚  â”‚  (ç«¯å£7070)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                 â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                  â”‚                 â”‚                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚  SQLiteæ•°æ®åº“   â”‚  â”‚  é…ç½®æ–‡ä»¶  â”‚               â”‚
â”‚         â”‚  (è¯·æ±‚å†å²)     â”‚  â”‚  (è§„åˆ™)    â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIå·¥å…· (Claude/Codex/Gemini)             â”‚
â”‚  å‘èµ·è¯·æ±‚ â†’ ç»è¿‡ä»£ç†(7070) â†’ è§„åˆ™ä¿®æ”¹ â†’ è½¬å‘ä¸Šæ¸¸API          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ APIé€šä¿¡åè®®

### åç«¯APIç«¯ç‚¹ï¼ˆç«¯å£7071ï¼‰

#### 1. è§„åˆ™ç®¡ç†
```
GET    /api/rules              # è·å–æ‰€æœ‰è§„åˆ™
POST   /api/rules              # åˆ›å»ºè§„åˆ™
GET    /api/rules/:id          # è·å–å•ä¸ªè§„åˆ™
PUT    /api/rules/:id          # æ›´æ–°è§„åˆ™
DELETE /api/rules/:id          # åˆ é™¤è§„åˆ™
POST   /api/rules/batch        # æ‰¹é‡æ“ä½œ
```

#### 2. è¯·æ±‚å†å²
```
GET    /api/requests           # è·å–è¯·æ±‚åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
GET    /api/requests/:id       # è·å–è¯·æ±‚è¯¦æƒ…
POST   /api/requests/cleanup   # æ¸…ç†æ—§æ•°æ®
DELETE /api/requests/:id       # åˆ é™¤å•ä¸ªè¯·æ±‚
```

#### 3. å®æ—¶æ¨é€
```
GET    /api/events             # SSEè¿æ¥ï¼ˆæ–°è¯·æ±‚æ¨é€ï¼‰
```

#### 4. é…ç½®ç®¡ç†
```
GET    /api/config             # è·å–é…ç½®
POST   /api/config/sync        # åŒæ­¥é…ç½®ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰
POST   /api/config/export      # å¯¼å‡ºé…ç½®
POST   /api/config/import      # å¯¼å…¥é…ç½®
```

#### 5. é¢„è§ˆæµ‹è¯•
```
POST   /api/preview            # é¢„è§ˆè§„åˆ™æ•ˆæœ
```

### SSEäº‹ä»¶ç±»å‹

```typescript
// æ–°è¯·æ±‚äº‹ä»¶
event: request
data: {
  "id": "req-20251220-143215-abc",
  "timestamp": 1734705135000,
  "client": "codex",
  "path": "/v1/chat/completions",
  "method": "POST"
}

// é…ç½®æ›´æ–°äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
event: config_updated
data: {
  "timestamp": 1734705135000,
  "ruleCount": 42
}
```

---

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### åç«¯æŠ€æœ¯æ ˆ

```json
{
  "dependencies": {
    "express": "^4.18.2",        // Webæ¡†æ¶
    "sqlite3": "^5.1.6",         // SQLiteæ•°æ®åº“
    "sqlite": "^4.1.2",          // SQLite TypeScriptå°è£…
    "cors": "^2.8.5"             // è·¨åŸŸæ”¯æŒ
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "typescript": "^5.3.2",
    "ts-node": "^10.9.1",
    "nodemon": "^3.0.2"
  }
}
```

### å‰ç«¯æŠ€æœ¯æ ˆ

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@heroui/react": "^2.2.0",      // HeroUIç»„ä»¶åº“
    "@heroui/system": "^2.2.0",
    "framer-motion": "^10.16.0",    // åŠ¨ç”»åº“
    "zustand": "^4.4.0",            // çŠ¶æ€ç®¡ç†
    "@tanstack/react-query": "^5.0.0", // æ•°æ®è·å–
    "axios": "^1.6.0"               // HTTPå®¢æˆ·ç«¯
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.2",
    "vite": "^5.0.0",
    "tailwindcss": "^3.3.0",
    "postcss": "^8.4.31",
    "autoprefixer": "^10.4.16"
  }
}
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### 1. è§„åˆ™ (Rule)

```typescript
interface Rule {
  id: string;              // å”¯ä¸€æ ‡è¯†
  description?: string;    // æè¿°

  when: {
    client: 'claude' | 'codex' | 'gemini';
    field: 'system' | 'instructions';
    method?: string;
    pathRegex?: string;
    modelRegex?: string;
  };

  ops: Array<
    | { type: 'set'; text: string }
    | { type: 'append'; text: string }
    | { type: 'prepend'; text: string }
    | { type: 'replace'; match?: string; regex?: string; flags?: string; replacement: string }
    | { type: 'delete'; match?: string; regex?: string; flags?: string }
    | { type: 'insert_before'; regex: string; flags?: string; text: string }
    | { type: 'insert_after'; regex: string; flags?: string; text: string }
  >;

  stop?: boolean;          // æ˜¯å¦åœ¨æ­¤ååœæ­¢
  enabled: boolean;        // æ˜¯å¦å¯ç”¨
  createdAt: number;       // åˆ›å»ºæ—¶é—´
  updatedAt: number;       // æ›´æ–°æ—¶é—´
}
```

### 2. è¯·æ±‚è®°å½• (RequestRecord)

```typescript
interface RequestRecord {
  id: string;
  timestamp: number;

  // è¯·æ±‚ä¿¡æ¯
  client: string;
  path: string;
  method: string;

  // è¯·æ±‚ä½“
  originalBody: any;       // åŸå§‹è¯·æ±‚
  modifiedBody: any;       // ä¿®æ”¹åè¯·æ±‚

  // è§„åˆ™åŒ¹é…
  matchedRules: Array<{
    ruleId: string;
    opType: string;
  }>;

  // å“åº”ä¿¡æ¯
  responseStatus?: number;
  durationMs?: number;
  responseHeaders?: Record<string, string>;
  error?: string;
}
```

### 3. é…ç½® (Config)

```typescript
interface Config {
  listen: {
    host: string;
    port: number;          // ä»£ç†ç«¯å£ 7070
  };

  api: {
    host: string;
    port: number;          // APIç«¯å£ 7071
  };

  upstreams: {
    anthropic: string;
    openai: string;
    gemini: string;
  };

  rules: Rule[];

  storage: {
    maxHistory: number;    // 100
    autoCleanup: boolean;  // true
    cleanupInterval: number; // å°æ—¶
  };

  debug: boolean;
}
```

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### æµç¨‹1ï¼šè§„åˆ™ç¼–è¾‘ä¸ç”Ÿæ•ˆ

```
ç”¨æˆ·åœ¨å‰ç«¯ç¼–è¾‘è§„åˆ™
  â†“
ç‚¹å‡»ä¿å­˜
  â†“
å‰ç«¯ POST /api/config/sync
  â†“
åç«¯ï¼š
  1. éªŒè¯è§„åˆ™æ ¼å¼
  2. æ›´æ–°å†…å­˜ä¸­çš„config.rules
  3. å†™å…¥ ~/.local/promptxy/config.json
  4. è¿”å›æˆåŠŸ
  â†“
å‰ç«¯æ˜¾ç¤ºä¿å­˜æˆåŠŸ
  â†“
ä¸‹ä¸€ä¸ªCLIè¯·æ±‚åˆ°è¾¾ä»£ç†(7070)
  â†“
ä»£ç†ä½¿ç”¨æ–°è§„åˆ™ä¿®æ”¹è¯·æ±‚
  â†“
å®Œæˆ
```

### æµç¨‹2ï¼šè¯·æ±‚æ•è·ä¸å±•ç¤º

```
CLIå‘èµ·è¯·æ±‚ â†’ ä»£ç†(7070)
  â†“
ä»£ç†æ•è·è¯·æ±‚ï¼š
  1. è®°å½•åŸå§‹è¯·æ±‚ä½“
  2. åº”ç”¨è§„åˆ™ â†’ å¾—åˆ°ä¿®æ”¹åè¯·æ±‚
  3. è½¬å‘åˆ°ä¸Šæ¸¸API
  4. è·å–å“åº”
  5. è®°å½•åˆ°SQLite
  6. é€šè¿‡SSEæ¨é€äº‹ä»¶
  â†“
å‰ç«¯SSEå®¢æˆ·ç«¯æ”¶åˆ°äº‹ä»¶
  â†“
å‰ç«¯ GET /api/requests/:id
  â†“
æ˜¾ç¤ºè¯·æ±‚è¯¦æƒ…ï¼ˆåŸå§‹ vs ä¿®æ”¹å¯¹æ¯”ï¼‰
```

### æµç¨‹3ï¼šæ•°æ®æ¸…ç†

```
åç«¯å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶ï¼‰ï¼š
  â†“
æ£€æŸ¥æ•°æ®åº“è®°å½•æ•°
  â†“
å¦‚æœ > 100æ¡
  â†“
DELETE FROM requests
WHERE id NOT IN (
  SELECT id FROM requests
  ORDER BY timestamp DESC
  LIMIT 100
)
  â†“
è®°å½•æ¸…ç†æ—¥å¿—
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡ï¼ˆHeroUIï¼‰

### é¡µé¢1ï¼šè§„åˆ™åˆ—è¡¨ (RulesPage)

**ç»„ä»¶ç»“æ„ï¼š**
```
<Page>
  <Header title="è§„åˆ™ç®¡ç†" actions={[æ–°å»º, æ‰¹é‡æ“ä½œ]} />

  <SearchAndFilter>
    <Input placeholder="æœç´¢è§„åˆ™..." />
    <Select label="å®¢æˆ·ç«¯" options={[å…¨éƒ¨, Claude, Codex, Gemini]} />
    <Select label="çŠ¶æ€" options={[å…¨éƒ¨, å¯ç”¨, ç¦ç”¨]} />
  </SearchAndFilter>

  <Stats cards={[
    { label: 'æ€»æ•°', value: 42 },
    { label: 'å¯ç”¨', value: 38, color: 'success' },
    { label: 'ç¦ç”¨', value: 4, color: 'error' }
  ]} />

  <RuleList>
    {rules.map(rule => (
      <RuleCard
        key={rule.id}
        rule={rule}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onToggle={handleToggle}
      />
    ))}
  </RuleList>

  <Pagination />
</Page>
```

**HeroUIç»„ä»¶ä½¿ç”¨ï¼š**
- `@heroui/input` - æœç´¢æ¡†
- `@heroui/select` - ç­›é€‰å™¨
- `@heroui/card` - è§„åˆ™å¡ç‰‡
- `@heroui/button` - æ“ä½œæŒ‰é’®
- `@heroui/modal` - ç¼–è¾‘å¼¹çª—
- `@heroui/pagination` - åˆ†é¡µ

### é¡µé¢2ï¼šè¯·æ±‚è¯¦æƒ… (RequestDetail)

**ç»„ä»¶ç»“æ„ï¼š**
```
<Modal open={true} onClose={close}>
  <Modal.Header>
    <Text h3>è¯·æ±‚è¯¦æƒ…</Text>
  </Modal.Header>

  <Modal.Body>
    <Grid>
      <Grid xs={12}>
        <Card>
          <Card.Body>
            <Description
              data={{
                ID: request.id,
                æ—¶é—´: formatTime(request.timestamp),
                å®¢æˆ·ç«¯: request.client,
                è·¯å¾„: request.path,
                çŠ¶æ€: request.responseStatus
              }}
            />
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={6}>
        <Card>
          <Card.Header>åŸå§‹è¯·æ±‚</Card.Header>
          <Card.Body>
            <CodeBlock language="json">
              {JSON.stringify(request.originalBody, null, 2)}
            </CodeBlock>
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={6}>
        <Card>
          <Card.Header>ä¿®æ”¹åè¯·æ±‚</Card.Header>
          <Card.Body>
            <CodeBlock language="json">
              {JSON.stringify(request.modifiedBody, null, 2)}
            </CodeBlock>
          </Card.Body>
        </Card>
      </Grid>

      <Grid xs={12}>
        <Card>
          <Card.Header>åŒ¹é…è§„åˆ™</Card.Header>
          <Card.Body>
            <List>
              {request.matchedRules.map(match => (
                <List.Item key={match.ruleId}>
                  {match.ruleId} ({match.opType})
                </List.Item>
              ))}
            </List>
          </Card.Body>
        </Card>
      </Grid>
    </Grid>
  </Modal.Body>

  <Modal.Footer>
    <Button onPress={replay}>é‡æ”¾</Button>
    <Button onPress={export}>å¯¼å‡º</Button>
    <Button onPress={close}>å…³é—­</Button>
  </Modal.Footer>
</Modal>
```

---

## ğŸ“ å¼€å‘ä»»åŠ¡æ¸…å•

### é˜¶æ®µ1ï¼šåç«¯å®ç°

- [ ] åˆ›å»º backend ç›®å½•ç»“æ„
- [ ] åˆå§‹åŒ– TypeScript é…ç½®
- [ ] å®‰è£…ä¾èµ– (express, sqlite3, etc.)
- [ ] å®ç° database.ts (SQLiteåˆå§‹åŒ–ã€CRUD)
- [ ] å®ç° config.ts (é…ç½®è¯»å†™)
- [ ] æ‰©å±• gateway.ts (æ·»åŠ è¯·æ±‚è®°å½•ã€SSEæ¨é€)
- [ ] å®ç° api-server.ts (æ‰€æœ‰APIç«¯ç‚¹)
- [ ] ä¿®æ”¹ main.ts (å¯åŠ¨ä¸¤ä¸ªæœåŠ¡å™¨)
- [ ] æµ‹è¯•APIç«¯ç‚¹

### é˜¶æ®µ2ï¼šå‰ç«¯åˆå§‹åŒ–

- [ ] åˆ›å»º frontend ç›®å½•ç»“æ„
- [ ] åˆå§‹åŒ– Vite + React + TypeScript
- [ ] å®‰è£… HeroUI åŠä¾èµ–
- [ ] é…ç½® Tailwind CSS
- [ ] åˆ›å»ºåŸºç¡€è·¯ç”±ç»“æ„
- [ ] å®ç° API å®¢æˆ·ç«¯
- [ ] å®ç° SSE å®¢æˆ·ç«¯
- [ ] åˆ›å»º Zustand stores

### é˜¶æ®µ3ï¼šå‰ç«¯é¡µé¢å®ç°

- [ ] RulesPage (åˆ—è¡¨ã€ç¼–è¾‘ã€åˆ é™¤)
- [ ] RequestsPage (åˆ—è¡¨ã€ç­›é€‰ã€åˆ†é¡µ)
- [ ] RequestDetail (æ¨¡æ€æ¡†ã€å·¦å³å¯¹æ¯”)
- [ ] PreviewPage (æµ‹è¯•æ²™ç›’)
- [ ] SettingsPage (é…ç½®ç®¡ç†)

### é˜¶æ®µ4ï¼šé›†æˆä¸éƒ¨ç½²

- [ ] å‰åç«¯è”è°ƒæµ‹è¯•
- [ ] å¼€å‘ç¯å¢ƒè„šæœ¬ (dev.sh)
- [ ] æ„å»ºè„šæœ¬ (build.sh)
- [ ] ç”Ÿäº§éƒ¨ç½²é…ç½®
- [ ] Dockeræ”¯æŒ (å¯é€‰)
- [ ] æ–‡æ¡£å®Œå–„

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ

**1. å¯åŠ¨åç«¯**
```bash
cd backend
npm install
npm run dev  # ç›‘å¬æ¨¡å¼ï¼Œç«¯å£7070 + 7071
```

**2. å¯åŠ¨å‰ç«¯**
```bash
cd frontend
npm install
npm run dev  # Viteå¼€å‘æœåŠ¡å™¨ï¼Œé»˜è®¤5173
```

**3. é…ç½®ä»£ç†**
```bash
# Claude Code
export ANTHROPIC_BASE_URL="http://127.0.0.1:7070"

# Codex CLI
export OPENAI_BASE_URL="http://127.0.0.1:7070/openai"

# Gemini CLI
export GOOGLE_GEMINI_BASE_URL="http://127.0.0.1:7070/gemini"
```

**4. è®¿é—®Web UI**
```
http://localhost:5173
```

### ç”Ÿäº§éƒ¨ç½²

```bash
# 1. æ„å»ºå‰ç«¯
cd frontend
npm run build

# 2. å¤åˆ¶åˆ°åç«¯é™æ€ç›®å½•
cp -r dist/* ../backend/public/

# 3. å¯åŠ¨åç«¯ï¼ˆä¼šåŒæ—¶æä¾›APIå’Œé™æ€æ–‡ä»¶ï¼‰
cd ../backend
npm start
```

è®¿é—®ï¼š`http://localhost:7071`

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆåˆ†å¼€å¼€å‘ä½†ç»Ÿä¸€éƒ¨ç½²ï¼Ÿ
- **å¼€å‘ä½“éªŒ**ï¼šå‰ç«¯çƒ­é‡è½½ï¼Œåç«¯ç‹¬ç«‹é‡å¯
- **éƒ¨ç½²ç®€å•**ï¼šæœ€ç»ˆä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªç«¯å£
- **ç»´æŠ¤æ–¹ä¾¿**ï¼šæ¸…æ™°çš„ä»£ç åˆ†ç¦»

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨SSEè€Œä¸æ˜¯WebSocketï¼Ÿ
- **å•å‘é€šä¿¡**ï¼šåªéœ€è¦æœåŠ¡å™¨æ¨é€æ–°è¯·æ±‚
- **å®ç°ç®€å•**ï¼šåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–åº“
- **èµ„æºå‹å¥½**ï¼šè¿æ¥æ•°é™åˆ¶æ›´å°‘

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨SQLiteè€Œä¸æ˜¯æ–‡ä»¶JSONï¼Ÿ
- **æŸ¥è¯¢èƒ½åŠ›**ï¼šæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€ç´¢å¼•
- **å¹¶å‘å®‰å…¨**ï¼šé¿å…æ–‡ä»¶é”é—®é¢˜
- **æ€§èƒ½**ï¼š100æ¡è®°å½•æŸ¥è¯¢æ¯«ç§’çº§

### 4. ä¸ºä»€ä¹ˆä½¿ç”¨HeroUIï¼Ÿ
- **ç»„ä»¶ä¸°å¯Œ**ï¼šè¡¨å•ã€è¡¨æ ¼ã€æ¨¡æ€æ¡†ç­‰å¼€ç®±å³ç”¨
- **ç¾è§‚ä¸“ä¸š**ï¼šç¬¦åˆå¼€å‘è€…å·¥å…·å®¡ç¾
- **TypeScriptå‹å¥½**ï¼šå®Œæ•´ç±»å‹æ”¯æŒ
- **Tailwindé›†æˆ**ï¼šæ˜“äºè‡ªå®šä¹‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åç«¯APIæ‰©å±•è®¾è®¡](./BACKEND_API_EXTENSION.md)
- [å‰ç«¯HeroUIé…ç½®æŒ‡å—](./FRONTEND_SETUP.md) (å¾…åˆ›å»º)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md) (å¾…åˆ›å»º)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-20
**çŠ¶æ€**: å¾…å®ç°
