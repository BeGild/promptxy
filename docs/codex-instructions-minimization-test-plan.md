# Codex Instructions æœ€å°åŒ–æ¢ç´¢æ–¹æ¡ˆ

> ç›®æ ‡ï¼šæ‰¾åˆ°ä¸Šæ¸¸ä¾›åº”å•†æ£€æµ‹çš„"æœ€å°å¿…è¦ç‰¹å¾"ï¼Œé‡Šæ”¾ç©ºé—´ç»™ Claude è‡ªå®šä¹‰æŒ‡ä»¤

## çŠ¶æ€æ¦‚è§ˆ

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| åŸå§‹æ¨¡æ¿ | `gpt_5_2.md` (336è¡Œ, ~26KB) |
| å¤‡ä»½ä½ç½® | `gpt_5_2.md.backup` |
| æµ‹è¯•å·¥å…· | `cc_lo -p 'prompt'` |
| ä¸Šæ¸¸é™åˆ¶ | æ— é¢‘ç‡é™åˆ¶ |
| å½“å‰æ¨¡æ¿ | `gpt_5_2.md` (è¿è¡Œæ—¶ä¿®æ”¹) |

---

## ä¸€ã€åŸºå‡†æµ‹è¯• (Baseline)

### 1.1 éªŒè¯åŸå§‹çŠ¶æ€
**ç›®çš„**ï¼šç¡®è®¤å®Œå…¨ä¼ªè£…æ¨¡å¼ä¸‹ç³»ç»Ÿæ­£å¸¸å·¥ä½œ

**å‘½ä»¤**ï¼š
```bash
cc_lo -p "ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ"
```

**é¢„æœŸ**ï¼š
- HTTP 200
- å“åº”å†…å®¹æ­£å¸¸

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

## äºŒã€æµ‹è¯•åºåˆ—

### Phase 1: ç»“æ„æ€§äºŒåˆ†

#### Test 1: ä»…ä¿ç•™é¦–è¡Œèº«ä»½
**å‡è®¾**ï¼šèº«ä»½å£°æ˜æ˜¯å”¯ä¸€å¿…éœ€çš„éªŒè¯

**æ¨¡æ¿å†…å®¹**ï¼š
```markdown
You are GPT-5.2 running in the Codex CLI, a terminal-based coding assistant.
```

**å‘½ä»¤**ï¼š
```bash
cc_lo -p "1+1ç­‰äºå‡ ï¼Ÿ"
```

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

#### Test 2: é¦–è¡Œ + èƒ½åŠ›æ®µ
**å‡è®¾**ï¼šéœ€è¦èº«ä»½ + åŸºæœ¬èƒ½åŠ›æè¿°

**æ¨¡æ¿å†…å®¹**ï¼š
```markdown
You are GPT-5.2 running in the Codex CLI, a terminal-based coding assistant. Codex CLI is an open source project led by OpenAI. You are expected to be precise, safe, and helpful.

Your capabilities:
- Receive user prompts and other context provided by the harness
- Communicate with the user by streaming thinking & responses
- Emit function calls to run terminal commands and apply patches
```

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

#### Test 3: èº«ä»½ + Personality æ®µ
**å‡è®¾**ï¼šéœ€è¦è¡Œä¸ºæŒ‡å¯¼æ®µè½

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

### Phase 2: å…³é”®è¯å®šä½

| Test ID | å…³é”®è¯ç»„åˆ | å‡è®¾ | çŠ¶æ€ |
|---------|-----------|------|------|
| A | "GPT-5.2" | ç‰ˆæœ¬å·å¿…éœ€ | â¬œ å¾…æµ‹ |
| B | "Codex CLI" | äº§å“åå¿…éœ€ | â¬œ å¾…æµ‹ |
| C | "OpenAI" | ä¾›åº”å•†å¿…éœ€ | â¬œ å¾…æµ‹ |
| D | "GPT-5.2" + "Codex CLI" | ç»„åˆæ£€æµ‹ | â¬œ å¾…æµ‹ |
| E | ä¼ªé€ å†…å®¹å«å…³é”®è¯ | é­”æœ¯è¯æ£€æµ‹ | â¬œ å¾…æµ‹ |

---

### Phase 3: æ³¨å…¥æµ‹è¯•

#### Test F: Claude æŒ‡ä»¤å‰ç½®
**å‡è®¾**ï¼šClaude æŒ‡ä»¤æ”¾åœ¨å‰é¢ï¼ŒGPT éªŒè¯æ”¾åœ¨åé¢

```markdown
# Claude Instructions
You are Claude, made by Anthropic. Be helpful and harmless.

# GPT Verification
You are GPT-5.2 running in the Codex CLI...
```

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

#### Test G: Claude æŒ‡ä»¤åç½®
**å‡è®¾**ï¼šå…ˆé€šè¿‡éªŒè¯ï¼Œå†æ³¨å…¥ Claude æŒ‡ä»¤

```markdown
You are GPT-5.2 running in the Codex CLI...

Additional instructions:
You are Claude, made by Anthropic. Prioritize safety and honesty.
```

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

#### Test H: æ··åˆç­–ç•¥
**å‡è®¾**ï¼šå…³é”®è¯ç©¿æ’åœ¨åŒä¸€æ®µè½

**çŠ¶æ€**ï¼šâ¬œ å¾…æµ‹è¯•

---

## ä¸‰ã€é¢„æœŸä¿¡å·

### æˆåŠŸä¿¡å·
- HTTP 200
- å“åº”æµæ­£å¸¸
- æ¨¡å‹èƒ½æ­£å¸¸å›ç­”

### å¤±è´¥ä¿¡å·
| ç±»å‹ | çŠ¶æ€ç  | ç‰¹å¾ |
|------|--------|------|
| ç›´æ¥æ‹’ç» | 403/401 | è®¤è¯å¤±è´¥ |
| å†…å®¹æ‹’ç» | 200 | å“åº”ä¸ºç©º/é”™è¯¯æç¤º |
| æ ¼å¼é”™è¯¯ | 400 | è¯·æ±‚æ ¼å¼è¢«æ‹’ç» |
| è¶…æ—¶ | - | é•¿æ—¶é—´æ— å“åº” |

---

## å››ã€æµ‹è¯•è®°å½•

| Test ID | ä¿®æ”¹å†…å®¹ | é¢„æœŸ | å®é™… | ç»“è®º | æ—¶é—´æˆ³ |
|---------|---------|------|------|------|--------|
| Baseline | å®Œæ•´336è¡Œæ¨¡æ¿ | æˆåŠŸ | âœ“ æˆåŠŸ | åŸºçº¿ç¡®è®¤ | 2025-01-10 |
| Test 1 | ä»…é¦–è¡Œèº«ä»½ | ? | âœ“ æˆåŠŸ | å•è¡Œè¶³å¤Ÿ | 2025-01-10 |
| Test 2a | ç§»é™¤ Codex CLI | ? | âœ“ æˆåŠŸ | è¯¥å…³é”®è¯éå¿…éœ€ | 2025-01-10 |
| Test 2b | ä»… GPT-5.2 | ? | âœ“ æˆåŠŸ | èº«ä»½å£°æ˜è¶³å¤Ÿ | 2025-01-10 |
| Test 2c | ä»…å…³é”®è¯ "GPT-5.2" | ? | âœ“ æˆåŠŸ | æ— éœ€å®Œæ•´å¥å­ | 2025-01-10 |
| Test 2d | "GPT-5" | ? | âœ“ æˆåŠŸ | ç‰ˆæœ¬å·éå¿…éœ€ | 2025-01-10 |
| Test 2e | "OpenAI" | ? | âœ“ æˆåŠŸ | ä¾›åº”å•†åå³å¯ | 2025-01-10 |
| Test 2f | **ç©ºå†…å®¹** | å¤±è´¥ | âœ“ **æˆåŠŸ** | **æ— éœ€ä»»ä½•éªŒè¯** | 2025-01-10 |
| Test F | Claude æŒ‡ä»¤æ³¨å…¥ | ? | âœ“ æˆåŠŸ | å®Œå…¨å¯è‡ªå®šä¹‰ | 2025-01-10 |
| Test F2 | Constitutional AI | ? | âœ“ æˆåŠŸ | é«˜è´¨é‡æŒ‡ä»¤æœ‰æ•ˆ | 2025-01-10 |
| Test F3 | æŒ‡ä»¤éµå¾ªéªŒè¯ | ? | âœ“ éƒ¨åˆ†éµå¾ª | æŒ‡ä»¤ä¸ç”¨æˆ·è¯·æ±‚å¹³è¡¡ | 2025-01-10 |
| Test F4 | å®‰å…¨çº¦æŸæµ‹è¯• | ? | âœ“ åˆç†åˆ¤æ–­ | ç«¯å£æ‰«æè¢«å…è®¸ | 2025-01-10 |

---

## äº”ã€å†³ç­–æ ‘

```
Test 1 (ä»…é¦–è¡Œ)
 â”‚
 â”œâ”€ æˆåŠŸ â†’ è¿›å…¥å…³é”®è¯ç²¾ç‚¼ (Phase 2)
 â”‚
 â””â”€ å¤±è´¥ â†’ Test 2 (é¦–è¡Œ+èƒ½åŠ›æ®µ)
             â”‚
             â”œâ”€ æˆåŠŸ â†’ é€æ­¥æ®µè½å‰¥ç¦»
             â”‚
             â””â”€ å¤±è´¥ â†’ Test 3 (ç»“æ„ä¿ç•™)
                         â”‚
                         â”œâ”€ æˆåŠŸ â†’ æ ‡é¢˜é‡è¦æ€§éªŒè¯
                         â”‚
                         â””â”€ å¤±è´¥ â†’ Test E (åå‘ä¸Šé™)
                                    â”‚
                                    â”œâ”€ æˆåŠŸ â†’ å¤šç»´åº¦æ£€æµ‹ç¡®è®¤
                                    â””â”€ å¤±è´¥ â†’ å¯èƒ½æ£€æµ‹æ›´æ·±å±‚æ¬¡ç‰¹å¾
```

---

## å…­ã€æœ€ç»ˆç»“è®º (Final Results)

### ğŸ¯ æ ¸å¿ƒå‘ç°

**ä¸Šæ¸¸ä¾›åº”å•†å¹¶æ²¡æœ‰å¯¹ `instructions` å­—æ®µè¿›è¡Œä»»ä½•å†…å®¹éªŒè¯ã€‚**

è¿™é€šè¿‡ Test 2fï¼ˆç©ºå†…å®¹å®Œå…¨é€šè¿‡ï¼‰å¾—åˆ°è¯å®ã€‚ä¹‹å‰çš„å‡è®¾â€”â€”ä¸Šæ¸¸ä¼šæ£€æµ‹ GPT/Codex/OpenAI ç­‰å…³é”®è¯â€”â€”æ˜¯ä¸æˆç«‹çš„ã€‚

### ğŸ“Š æµ‹è¯•è·¯å¾„æ‘˜è¦

```
Baseline (336è¡Œ) â†’ Test 1 (1è¡Œ) â†’ Test 2a (æ— Codex) â†’ Test 2b (ä»…GPT-5.2)
â†’ Test 2c (ä»…å…³é”®è¯) â†’ Test 2d (GPT-5) â†’ Test 2e (OpenAI) â†’ Test 2f (ç©º)
â†’ Test F (Claudeæ³¨å…¥) â†’ Test F2 (Constitutional AI) â†’ âœ“ å…¨éƒ¨é€šè¿‡
```

### âœ… æœ€å°é€šè¿‡é›†

**é›¶å­—ç¬¦**ï¼ˆç©º instructions å­—æ®µï¼‰

### ğŸš€ æ¨èé…ç½®

æ—¢ç„¶ä¸Šæ¸¸ä¸éªŒè¯ instructions å†…å®¹ï¼Œå»ºè®®ï¼š

1. **å®Œå…¨è‡ªå®šä¹‰**ï¼šä½¿ç”¨é€‚åˆ Claude çš„é«˜è´¨é‡ç³»ç»Ÿæç¤ºè¯
2. **å½“å‰æ¨¡æ¿** (43è¡Œ Constitutional AI) å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹
3. **æœªæ¥ä¼˜åŒ–**ï¼šå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æŒç»­æ”¹è¿›æŒ‡ä»¤è´¨é‡

### ğŸ“ å®é™…éªŒè¯ç»´åº¦ï¼ˆæ¨æµ‹ï¼‰

ä¸Šæ¸¸çš„éªŒè¯å¯èƒ½å‘ç”Ÿåœ¨ï¼š
- è¯·æ±‚å¤´ï¼ˆUser-Agent, Authorization ç­‰ï¼‰
- API è·¯å¾„ (`/responses`)
- è¯·æ±‚ä½“ç»“æ„ï¼ˆmodel, tools ç­‰å­—æ®µçš„æ ¼å¼ï¼‰
- API Token æœ‰æ•ˆæ€§

è€Œé instructions å†…å®¹æœ¬èº«ã€‚

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **æœªæ¥å¯èƒ½çš„å˜åŒ–**ï¼šä¸Šæ¸¸éšæ—¶å¯èƒ½å¢åŠ éªŒè¯æœºåˆ¶
2. **å»ºè®®ä¿ç•™æœ€å°éªŒè¯æ ‡è¯†**ï¼šå¦‚ "You are a helpful assistant" ç­‰é€šç”¨å†…å®¹
3. **ç›‘æ§ä¸Šæ¸¸å“åº”**ï¼šæ³¨æ„æ˜¯å¦æœ‰ 403/400 ç­‰éªŒè¯å¤±è´¥çš„ä¿¡å·

---

## å…«ã€æœ€ç»ˆå®ç°

**æ–¹æ¡ˆ**ï¼šç›´æ¥é€ä¼  `/claude` è¯·æ±‚çš„ `system.text` ä½œä¸º `instructions`

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `backend/src/promptxy/transformers/protocols/codex/render.ts`
  - åˆ é™¤ `DEFAULT_CODEX_INSTRUCTIONS` å¸¸é‡å’Œæ¨¡æ¿å¯¼å…¥
  - `renderInstructions()` ç›´æ¥è¿”å› `systemText`

- `backend/src/promptxy/transformers/audit/field-audit.ts`
  - `DefaultSource` ç±»å‹æ·»åŠ  `'claude_system'` é€‰é¡¹

**æ•ˆæœ**ï¼š
- instructions å®Œå…¨ç”± `/claude` è¯·æ±‚å†³å®š
- æ— éœ€ç»´æŠ¤æ¨¡æ¿æ–‡ä»¶
- æœ€å¤§çµæ´»æ€§

**å·²éªŒè¯æœ‰æ•ˆ** âœ“
