# Proposal: add-path-autocomplete

## Summary

将请求监控页面的搜索功能改造为 Autocomplete（自动补全）模式，减少后端请求压力，提升用户体验。

## Background

当前搜索功能存在以下问题：

1. **频繁请求**：每输入一个字都会触发后端 API 请求（虽有 300ms 防抖）
2. **输入框消失**：搜索时输入框会消失变成加载状态，用户无法继续编辑
3. **搜索压力大**：后端对 `id`、`path`、`original_body` 三个字段进行模糊匹配

## Goals

### 用户目标

- 点击输入框即可看到所有可能的请求路径
- 输入时进行本地过滤，实时显示匹配建议
- 选择路径后进行前缀匹配（如 `/api/users` 匹配 `/api/users/123`）

### 技术目标

- 新增 `GET /_promptxy/paths` API 返回唯一路径列表
- 前端使用 HeroUI Autocomplete 组件
- 支持路径前缀匹配和 ID 模糊匹配两种模式

## Proposed Solution

### 数据流

```
用户点击输入框
    ↓
前端加载路径列表 (GET /_promptxy/paths)
    ↓
用户输入 → 本地过滤 → 显示下拉建议
    ↓
用户选择路径
    ↓
触发搜索 (后端判断: 路径前缀匹配 vs ID 模糊匹配)
```

### 搜索逻辑

| 输入特征 | 匹配模式 |
|---------|---------|
| 以 `/` 开头 | 路径前缀匹配 (`path LIKE 'value%'`) |
| 其他 | ID/路径/请求体模糊匹配 (`LIKE '%value%'`) |

## Alternatives Considered

### 方案 A：纯前端过滤（当前已实现）
- **优点**：无后端改动
- **缺点**：输入触发 API 请求，搜索时输入框消失

### 方案 B：后端 Autocomplete API
- **优点**：数据准确，支持大量历史路径
- **缺点**：每次输入仍需请求后端

### 方案 C：混合模式（本方案）
- **优点**：加载一次路径列表，后续本地过滤，搜索压力小
- **缺点**：首次加载需额外请求

## Impact

### 用户体验

- 输入框始终可见，不再消失
- 搜索建议实时显示
- 支持前缀匹配，更符合预期

### 性能

- 新增 `GET /_promptxy/paths` 请求（仅在组件挂载时）
- 搜索请求减少（仅在选中路径或手动输入时触发）
- 数据库添加 `path` 索引提升查询效率

## Dependencies

- HeroUI Autocomplete 组件（已安装）
- 后端数据库 SQLite
- 前端 React 18

## Out of Scope

- 路径建议的搜索历史记录
- 路径分组或分类显示
- 服务端缓存（如 Redis）
