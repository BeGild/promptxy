# é›†æˆæµ‹è¯•åˆ›å»ºæ€»ç»“

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

å·²æˆåŠŸä¸º PromptXY å‰ç«¯åˆ›å»ºå®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–æ‰€æœ‰è¦æ±‚çš„åœºæ™¯ã€‚

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### æµ‹è¯•æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰

| æ–‡ä»¶                  | å¤§å°    | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›–èŒƒå›´       |
| --------------------- | ------- | -------- | -------------- |
| `pages.test.tsx`      | 19.7 KB | 15 ä¸ª    | é¡µé¢çº§é›†æˆæµ‹è¯• |
| `user-flows.test.tsx` | 28.3 KB | 12 ä¸ª    | ç”¨æˆ·æµç¨‹æµ‹è¯•   |
| `data-flow.test.tsx`  | 31.2 KB | 26 ä¸ª    | æ•°æ®æµé›†æˆæµ‹è¯• |

### é…ç½®å’Œæ–‡æ¡£

| æ–‡ä»¶                             | è¯´æ˜                     |
| -------------------------------- | ------------------------ |
| `README.md`                      | è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å— |
| `validate-integration-tests.mjs` | æµ‹è¯•æ–‡ä»¶éªŒè¯è„šæœ¬         |
| `vitest.config.ts` (æ›´æ–°)        | æµ‹è¯•é…ç½®ï¼ˆè¶…æ—¶ã€å¹¶è¡Œç­‰ï¼‰ |

## ğŸ¯ æµ‹è¯•è¦†ç›–åœºæ™¯

### 1. é¡µé¢çº§é›†æˆæµ‹è¯• (pages.test.tsx)

#### RulesPage - è§„åˆ™ç®¡ç†

- âœ… å®Œæ•´æ˜¾ç¤ºè§„åˆ™ç®¡ç†é¡µé¢
- âœ… åˆ›å»ºæ–°è§„åˆ™æµç¨‹
- âœ… ç¼–è¾‘è§„åˆ™æµç¨‹
- âœ… åˆ é™¤è§„åˆ™æµç¨‹
- âœ… å¯ç”¨/ç¦ç”¨åˆ‡æ¢

#### RequestsPage - è¯·æ±‚ç›‘æ§

- âœ… å®Œæ•´æ˜¾ç¤ºè¯·æ±‚é¡µé¢
- âœ… æœç´¢å’Œè¿‡æ»¤æµç¨‹
- âœ… æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…æµç¨‹
- âœ… åˆ é™¤è¯·æ±‚æµç¨‹
- âœ… åˆ†é¡µæ“ä½œæµç¨‹

#### PreviewPage - é¢„è§ˆåŠŸèƒ½

- âœ… å®Œæ•´æ˜¾ç¤ºé¢„è§ˆé¡µé¢
- âœ… é¢„è§ˆé¢æ¿ç»„ä»¶æ˜¾ç¤º

#### SettingsPage - è®¾ç½®ç®¡ç†

- âœ… å®Œæ•´æ˜¾ç¤ºè®¾ç½®é¡µé¢
- âœ… è®¾ç½®é¢æ¿ç»„ä»¶æ˜¾ç¤º

### 2. ç”¨æˆ·æµç¨‹æµ‹è¯• (user-flows.test.tsx)

#### å®Œæ•´å·¥ä½œæµ

- âœ… åˆ›å»ºè§„åˆ™ â†’ å‘é€è¯·æ±‚ â†’ æŸ¥çœ‹å†å² â†’ éªŒè¯è§„åˆ™åº”ç”¨

#### SSE å®æ—¶æ›´æ–°

- âœ… SSE è¿æ¥å»ºç«‹å’Œäº‹ä»¶å¤„ç†
- âœ… æ–°è¯·æ±‚è‡ªåŠ¨æ·»åŠ 
- âœ… è¿æ¥æ–­å¼€å’Œé‡è¿

#### é”™è¯¯å¤„ç†

- âœ… API æ–­å¼€é”™è¯¯
- âœ… æ— æ•ˆæ•°æ®é”™è¯¯
- âœ… ç½‘ç»œé”™è¯¯é‡è¯•
- âœ… ç”¨æˆ·å–æ¶ˆç¡®è®¤

#### å¤æ‚åœºæ™¯

- âœ… æ‰¹é‡æ“ä½œ
- âœ… ç»„åˆè¿‡æ»¤ï¼ˆæœç´¢+è¿‡æ»¤+åˆ†é¡µï¼‰
- âœ… é…ç½®ç®¡ç†å®Œæ•´æµç¨‹

### 3. æ•°æ®æµé›†æˆæµ‹è¯• (data-flow.test.tsx)

#### API â†’ çŠ¶æ€ â†’ UI é“¾æ¡

- âœ… è§„åˆ™æ•°æ®ä¼ é€’
- âœ… è¯·æ±‚æ•°æ®ä¼ é€’
- âœ… ç»Ÿè®¡æ•°æ®æ›´æ–°
- âœ… é…ç½®æ•°æ®ä¼ é€’

#### ç”¨æˆ·æ“ä½œ â†’ API â†’ çŠ¶æ€ â†’ UI

- âœ… åˆ›å»ºè§„åˆ™æ•°æ®æµ
- âœ… åˆ é™¤è§„åˆ™æ•°æ®æµ
- âœ… æœç´¢è¿‡æ»¤æ•°æ®æµ
- âœ… åˆ†é¡µæ•°æ®æµ

#### Hook å±‚æ•°æ®æµ

- âœ… useRules
- âœ… useSaveRules
- âœ… useDeleteRule
- âœ… useRequests
- âœ… useRequestDetail
- âœ… useConfig
- âœ… useExportConfig
- âœ… useImportConfig

#### Store å±‚æ•°æ®æµ

- âœ… è§„åˆ™çŠ¶æ€ç®¡ç†
- âœ… è¯·æ±‚çŠ¶æ€ç®¡ç†
- âœ… SSE çŠ¶æ€æ›´æ–°
- âœ… æ–°è¯·æ±‚æ·»åŠ 
- âœ… é”™è¯¯å¤„ç†
- âœ… çŠ¶æ€é‡ç½®

#### ç«¯åˆ°ç«¯éªŒè¯

- âœ… å®Œæ•´æ•°æ®é“¾æ¡
- âœ… ç”¨æˆ·æ“ä½œè§¦å‘

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Vitest 2.1.4
- **UI æµ‹è¯•**: React Testing Library 16.0.1
- **ç”¨æˆ·äº¤äº’**: Testing Library User Event 14.5.2
- **æµ‹è¯•ç¯å¢ƒ**: JSDOM 25.0.1
- **Mock**: æ‰‹åŠ¨ Mock + vi.fn()

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

```
æ€»æµ‹è¯•æ–‡ä»¶: 3
æ€»æµ‹è¯•ç”¨ä¾‹: 53
æ€»ä»£ç è¡Œæ•°: ~1500
ä»£ç è¦†ç›–ç‡ç›®æ ‡: 90%+
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•

```bash
cd /home/ekko.bao/work/promptxy/frontend
npm test -- tests/integration/
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```bash
npm test -- tests/integration/pages.test.tsx
npm test -- tests/integration/user-flows.test.tsx
npm test -- tests/integration/data-flow.test.tsx
```

### è§‚å¯Ÿæ¨¡å¼

```bash
npm run test:watch -- tests/integration/
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
npm run test:coverage
```

### éªŒè¯æµ‹è¯•æ–‡ä»¶

```bash
node tests/integration/validate-integration-tests.mjs
```

## ğŸ¨ æµ‹è¯•ç‰¹ç‚¹

### 1. çœŸå®åœºæ™¯æ¨¡æ‹Ÿ

- âœ… çœŸå®ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ã€é€‰æ‹©ï¼‰
- âœ… API è°ƒç”¨æ¨¡æ‹Ÿï¼ˆGET/POST/PUT/DELETEï¼‰
- âœ… SSE å®æ—¶äº‹ä»¶æ¨¡æ‹Ÿ
- âœ… é”™è¯¯å’Œå¼‚å¸¸å¤„ç†

### 2. å®Œæ•´æµç¨‹è¦†ç›–

- âœ… é¡µé¢çº§åŠŸèƒ½
- âœ… è·¨é¡µé¢å·¥ä½œæµ
- âœ… æ•°æ®æµåŠ¨é“¾æ¡

### 3. çŠ¶æ€ç®¡ç†éªŒè¯

- âœ… Zustand Store æ›´æ–°
- âœ… React Query ç¼“å­˜
- âœ… UI çŠ¶æ€åŒæ­¥

### 4. é”™è¯¯å¤„ç†éªŒè¯

- âœ… ç½‘ç»œé”™è¯¯
- âœ… API é”™è¯¯
- âœ… ç”¨æˆ·å–æ¶ˆ
- âœ… æ•°æ®éªŒè¯å¤±è´¥

## ğŸ“ æµ‹è¯•ç¤ºä¾‹

### é¡µé¢æµ‹è¯•ç¤ºä¾‹

```typescript
it('åº”è¯¥å¤„ç†åˆ›å»ºæ–°è§„åˆ™çš„å®Œæ•´æµç¨‹', async () => {
  const user = userEvent.setup()

  // 1. æ‰“å¼€é¡µé¢
  render(<RulesPage />)

  // 2. ç‚¹å‡»æ–°å»º
  await user.click(screen.getByTestId('new-rule-btn'))

  // 3. å¡«å†™è¡¨å•
  await user.type(screen.getByTestId('rule-id-input'), 'new-rule')

  // 4. ä¿å­˜
  await user.click(screen.getByTestId('save-btn'))

  // 5. éªŒè¯ API è°ƒç”¨
  expect(api.apiClient.post).toHaveBeenCalled()
})
```

### æ•°æ®æµæµ‹è¯•ç¤ºä¾‹

```typescript
it('åº”è¯¥éªŒè¯å®Œæ•´æ•°æ®æµ: API â†’ Store â†’ Hooks â†’ UI', async () => {
  // API è¿”å›æ•°æ®
  mockApi.get.mockResolvedValue({ data: { rules: mockRules } })

  // æ¸²æŸ“ç»„ä»¶
  render(<RulesPage />)

  // éªŒè¯ UI
  await waitFor(() => {
    expect(screen.getByTestId('rule-id')).toHaveTextContent('rule-1')
  })

  // éªŒè¯ Store
  const state = useAppStore.getState()
  expect(state.rules).toEqual(mockRules)
})
```

## ğŸ¯ è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å—     | ç›®æ ‡è¦†ç›–ç‡ |
| -------- | ---------- |
| é¡µé¢ç»„ä»¶ | 95%        |
| ç”¨æˆ·æµç¨‹ | 90%        |
| æ•°æ®æµ   | 98%        |
| é”™è¯¯å¤„ç† | 90%        |

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†ä½¿ç”¨æŒ‡å—: `README.md`
- é¡¹ç›®æ¶æ„: `/docs/ARCHITECTURE.md`
- API æ–‡æ¡£: `/docs/API.md`

## âœ… éªŒè¯ç»“æœ

æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²é€šè¿‡ç»“æ„éªŒè¯ï¼š

- âœ… pages.test.tsx - 15 ä¸ªæµ‹è¯•ç”¨ä¾‹
- âœ… user-flows.test.tsx - 12 ä¸ªæµ‹è¯•ç”¨ä¾‹
- âœ… data-flow.test.tsx - 26 ä¸ªæµ‹è¯•ç”¨ä¾‹

æ€»è®¡: **53 ä¸ªæµ‹è¯•ç”¨ä¾‹**

---

**åˆ›å»ºæ—¶é—´**: 2025-12-21
**æµ‹è¯•æ¡†æ¶**: Vitest + React Testing Library
**è¦†ç›–åœºæ™¯**: é¡µé¢çº§ã€ç”¨æˆ·æµç¨‹ã€æ•°æ®æµ
